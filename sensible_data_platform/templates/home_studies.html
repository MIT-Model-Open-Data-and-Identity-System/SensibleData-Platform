{% extends "base.html" %}

{% block content %}

<div class="page-header">
	      <h1>My Studies</h1>
	  </div>

<div class="row">

	<style>
		table { border:none }
		</style>


{% for service,status in services.items %}
	{% if 'error' in status %}

		{% if status.error == 'connection error' %}
			<div class="well span11">
				<form method="get" action="{{ status.authorize_url }}">
				<h1>{{ service }}</h1>
				<h4> {{ status.discovery.service_desc_full | safe }} </h4>
					</br>
					<h4><div class="span" style="margin:-13px 0px 0px; background-color:#c43c35; text-align:center; padding: 4px 20px 4px; font-weight: bold; white-space: pre-wrap; -webkit-border-radius: 3px; -moz-border-radius: 3px 3px 3px 3px; border-radius: 3px 3px 3px 3px; color: #ffffff;"> The Study seems to be offline at the moment. <a href="mailto:support@sensible.dtu.dk">Ping us.</a> Thanks!</div></h4>
			</form>
			</div>
		{% else %}
			<div class="well span11">
				<form method="get" action="{{ status.authorize_url }}">
				<h1>{{ service }}</h1>
				<h4> {{ status.discovery.service_desc_full | safe }} </h4>
					</br>
				   <p><button type="submit" name="submit" value="" class="btn btn-primary btn-large">Enroll <i class="icon-chevron-right icon-white"></i></button></p>
			</form>
			</div>
			{% endif %}
	{% else%}
		<div class="well span11">
			<h1>{{ service }}</h1>

			<h4> {{ status.description.service_desc_short | safe }} </h4>

				<div class="row">
				<div class="form-actions span" style="border: 1px solid #DDDDDD; background-color: #FFFFFF; border-radius: 4px 4px 4px 4px; margin-bottom:-10px; padding:2px 15px">
			<h2>Applications</h2>
				</div>
				</div>



			{% for application, params in status.applications.items %}
				<div class="form-actions" style="border: 1px solid #DDDDDD; background-color: #FFFFFF; border-radius: 4px 4px 4px 4px;margin-bottom:-10px">
						
					<h2>
					{% if params.uri != '' %}
						<a href="{{ params.uri }}">{{ application }}
						<button value="" class="btn btn-primary btn-small"><i class="icon-chevron-right icon-white"></i><i class="icon-chevron-right icon-white"></i></button></a>
					{% else %}
						{{ application }}

					{% endif %}
					</h2>
					<p><h4>{{ params.description | safe}}</h4></p>
					</br>

					<table class="table table-condensed table-striped">
						<tbody >
					{% for auth_uri, scopes in params.scopes.items %}
							<tr>
								<td class="span6" style="border-top: none; vertical-align:middle;">
						{% for scope, scope_params in scopes.items %}
							{% if scope != 'message' and scope != 'status' %}
								{% if scope_params.authorized == 1 %}
								<div class="span4" style="border-color: #46a546; padding: 2px 3px 0px; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px 3px 3px 3px; border-width:1px; border-style:solid; border-top-style:solid; margin: 20px 10px 20px">
								<h4><div class="" style="margin:-13px 0px 0px; background-color:#46a546; text-align:center; padding: 4px 20px 4px; font-weight: bold; white-space: pre-wrap; -webkit-border-radius: 3px; -moz-border-radius: 3px 3px 3px 3px; border-radius: 0px 0px 3px 3px; color: #ffffff;"> can {{ scope_params.description | safe }}</div></h4>
									{{ scope_params.description_extra | safe }}
								{% else %}
								<div class="span4" style="border-color: #c43c35; padding: 2px 3px 0px; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px 3px 3px 3px; border-width:1px; border-style:solid; border-top-style:solid; margin: 20px 10px 20px">
								<h4><div class="" style="margin:-13px 0px 0px; background-color:#c43c35; text-align:center; padding: 4px 20px 4px; font-weight: bold; white-space: pre-wrap; -webkit-border-radius: 3px; -moz-border-radius: 3px 3px 3px 3px; border-radius: 0px 0px 3px 3px; color: #ffffff;"> cannot {{ scope_params.description | safe }}</div></h4>
									{{ scope_params.description_extra | safe }}
								</div>
								{% endif %}
							{% endif %}
						{% endfor %}

								</td>

						{% if scopes.status == 0 %}

						<td style="text-align:left; vertical-align:middle; border-top: none">
						{% if auth_uri != '' %}
						<a href="{{ auth_uri }}"><button value="" class="btn btn-success">Auhtorize <i class="icon-chevron-right icon-white"></i></button></a>
						{% else %}
							<button disabled value="" class="btn btn-success">{{ scopes.message | safe}}</button>
						{% endif %}

						{% endif %}

						</td>
					
					</tr>


					{% endfor %}
						</tbody>
					</table>
					
		</form>
		</div>
			{% endfor %}


		</div>
	{% endif %}
	
{% endfor %}


</div>

{% endblock %}
